# æ±½è½¦ä¿¡æ¯æœåŠ¡å™¨ API æ–‡æ¡£

## ğŸ“‹ åŸºç¡€ä¿¡æ¯
- **åŸºç¡€URL**: http://localhost:3000
- **è®¤è¯æ–¹å¼**: JWT Bearer Token
- **å“åº”æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

## ğŸ” ç”¨æˆ·è®¤è¯ API

### 1. è·å–éªŒè¯ç 
- **æ¥å£**: `GET /api/captcha`
- **æè¿°**: è·å–å›¾å½¢éªŒè¯ç ï¼ˆç”¨äºæ³¨å†Œå’Œæ•æ„Ÿæ“ä½œï¼‰
- **è¯·æ±‚å‚æ•°**: æ— 
- **å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "éªŒè¯ç ç”ŸæˆæˆåŠŸ",
  "data": {
    "captchaId": "abc123",
    "image": "data:image/svg+xml;base64,..."
  }
}
```
- **è¯´æ˜**: éªŒè¯ç ä¸º4ä½æ•°å­—ï¼Œæœ‰æ•ˆæœŸ5åˆ†é’Ÿï¼Œæœ€å¤šå°è¯•3æ¬¡

### 2. ç”¨æˆ·æ³¨å†Œ
- **æ¥å£**: `POST /api/auth/register`
- **æè¿°**: ç”¨æˆ·æ³¨å†Œ
- **è¯·æ±‚å‚æ•°**:
  - `username`: å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œ3-50ä¸ªå­—ç¬¦ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œä¸­æ–‡
  - `password`: å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œè‡³å°‘6ä¸ªå­—ç¬¦
  - `real_name`: å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œ1-50ä¸ªå­—ç¬¦ï¼Œè”ç»œäººå§“å
  - `email`: å­—ç¬¦ä¸²ï¼Œå¯é€‰ï¼Œé‚®ç®±æ ¼å¼ï¼Œå®¢æˆ·ä¿¡æ¯
  - `gender`: å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œmale/female/other
  - `phone`: å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œæ‰‹æœºå·æ ¼å¼ï¼ˆæ”¯æŒä¸­å›½å¤§é™†11ä½æ‰‹æœºå·å’Œé¦™æ¸¯8ä½æ‰‹æœºå·ï¼‰
  - `captcha`: å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œ4ä½æ•°å­—éªŒè¯ç 
  - `captchaId`: å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼ŒéªŒè¯ç ID
- **å“åº”**: ç”¨æˆ·ä¿¡æ¯å’ŒJWTä»¤ç‰Œ
- **é”™è¯¯ç **: 400(å‚æ•°é”™è¯¯/ç”¨æˆ·åå·²å­˜åœ¨/é‚®ç®±å·²å­˜åœ¨/éªŒè¯ç é”™è¯¯), 500(æœåŠ¡å™¨é”™è¯¯)

### 3. ç”¨æˆ·ç™»å½•
- **æ¥å£**: `POST /api/auth/login`
- **æè¿°**: ç”¨æˆ·ç™»å½•
- **è¯·æ±‚å‚æ•°**:
  - `username`: å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œç”¨æˆ·å
  - `password`: å­—ç¬¦ä¸²ï¼Œå¿…å¡«ï¼Œå¯†ç 
  - `captcha`: å­—ç¬¦ä¸²ï¼Œå¯é€‰ï¼Œ4ä½æ•°å­—éªŒè¯ç ï¼ˆå½“ç³»ç»Ÿæ£€æµ‹åˆ°å¯ç–‘è¡Œä¸ºæ—¶ï¼‰
  - `captchaId`: å­—ç¬¦ä¸²ï¼Œå¯é€‰ï¼ŒéªŒè¯ç ID
- **å“åº”**: ç”¨æˆ·ä¿¡æ¯å’ŒJWTä»¤ç‰Œ
- **é”™è¯¯ç **: 400(å‚æ•°é”™è¯¯), 401(ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯), 403(è´¦æˆ·è¢«ç¦ç”¨), 500(æœåŠ¡å™¨é”™è¯¯)

### 4. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- **æ¥å£**: `GET /api/auth/me`
- **æè¿°**: è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯
- **è¯·æ±‚å¤´**: `Authorization: Bearer <token>`
- **å“åº”**: ç”¨æˆ·ä¿¡æ¯
- **é”™è¯¯ç **: 401(æœªæˆæƒ), 404(ç”¨æˆ·ä¸å­˜åœ¨), 500(æœåŠ¡å™¨é”™è¯¯)

### 5. ç”¨æˆ·ç™»å‡º
- **æ¥å£**: `POST /api/auth/logout`
- **æè¿°**: ç”¨æˆ·ç™»å‡º
- **è¯·æ±‚å¤´**: `Authorization: Bearer <token>`
- **å“åº”**: æˆåŠŸæ¶ˆæ¯
- **é”™è¯¯ç **: 401(æœªæˆæƒ), 500(æœåŠ¡å™¨é”™è¯¯)

## ğŸš— è½¦è¾†ä¿¡æ¯ API

### 1. è·å–è½¦è¾†åˆ—è¡¨
- **æ¥å£**: `GET /api/vehicles`
- **æè¿°**: è·å–è½¦è¾†åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’ŒåŸºç¡€ç­›é€‰
- **è¯·æ±‚å‚æ•°**:
  - `page`: é¡µç ï¼Œé»˜è®¤1
  - `limit`: æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20
  - `vehicle_type`: è½¦è¾†ç±»å‹ï¼ˆ1=ç§å®¶è½¦, 2=å®¢è´§è½¦, 3=è´§è½¦, 4=ç”µå•è½¦, 5=ç»å…¸è½¦ï¼‰
  - `vehicle_status`: è½¦è¾†çŠ¶æ€ï¼ˆ1=æœªå”®, 2=å·²å”®ï¼‰
  - `car_brand`: å“ç‰ŒæŸ¥è¯¢ï¼Œæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
    - æ¨¡ç³ŠåŒ¹é…ï¼š`ä¸°ç”°` (åŒ¹é…åŒ…å«"ä¸°ç”°"çš„å“ç‰Œ)
    - ç²¾ç¡®åŒ¹é…ï¼š`exact:ä¸°ç”°` (ç²¾ç¡®åŒ¹é…"ä¸°ç”°"å“ç‰Œ)
  - `car_model`: è½¦å‹æŸ¥è¯¢ï¼Œæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
    - æ¨¡ç³ŠåŒ¹é…ï¼š`å¡ç½—æ‹‰` (åŒ¹é…åŒ…å«"å¡ç½—æ‹‰"çš„è½¦å‹)
    - ç²¾ç¡®åŒ¹é…ï¼š`exact:å¡ç½—æ‹‰` (ç²¾ç¡®åŒ¹é…"å¡ç½—æ‹‰"è½¦å‹)
  - `year`: å¹´ä»½æŸ¥è¯¢ï¼Œæ”¯æŒå¤šç§æ¨¡å¼ï¼š
    - ç²¾ç¡®åŒ¹é…ï¼š`2016` (åŒ¹é…åŒ…å«2016çš„å¹´ä»½)
    - èŒƒå›´æŸ¥è¯¢ï¼š`2016-2018` (æŸ¥è¯¢2016åˆ°2018å¹´ä¹‹é—´çš„è½¦è¾†)
    - æ¯”è¾ƒæŸ¥è¯¢ï¼š`>2016`, `>=2016`, `<2018`, `<=2018` (æŸ¥è¯¢å¤§äº/å°äºæŒ‡å®šå¹´ä»½çš„è½¦è¾†)
  - `min_price`: æœ€ä½ä»·æ ¼ï¼ˆæ•°å­—ï¼ŒåŸºäºcurrent_priceå­—æ®µï¼‰
  - `max_price`: æœ€é«˜ä»·æ ¼ï¼ˆæ•°å­—ï¼ŒåŸºäºcurrent_priceå­—æ®µï¼‰
  - `sort_by`: æ’åºå­—æ®µï¼ˆcreated_at, updated_at, current_price, yearï¼‰
  - `sort_order`: æ’åºæ–¹å‘ï¼ˆASC, DESCï¼‰
- **è¯·æ±‚å¤´**: `Authorization: Bearer <token>` (å¯é€‰ï¼Œç”¨äºè·å–å®Œæ•´æ‰‹æœºå·)
- **å“åº”æ•°æ®**:
  ```json
  {
    "code": 200,
    "message": "æŸ¥è¯¢æˆåŠŸ",
    "data": {
      "vehicles": [
        {
          "id": 1,
          "vehicle_type": 1,
          "vehicle_status": 1,
          "car_brand": "ä¸°ç”°",
          "car_model": "å¡ç½—æ‹‰",
          "year": 2016,
          "current_price": 80000,
          "original_price": 120000,
          "mileage": 50000,
          "fuel_type": "æ±½æ²¹",
          "transmission": "è‡ªåŠ¨",
          "color": "ç™½è‰²",
          "contact_name": "å¼ å…ˆç”Ÿ",
          "contact_phone": "13******00", // æœªç™»å½•ç”¨æˆ·æ˜¾ç¤ºè„±æ•
          "contact_phone": "13800138000", // å·²ç™»å½•ç”¨æˆ·æ˜¾ç¤ºå®Œæ•´
          "description": "è½¦å†µè‰¯å¥½ï¼Œæ— äº‹æ•…",
          "created_at": "2024-01-01T00:00:00.000Z",
          "updated_at": "2024-01-01T00:00:00.000Z"
        }
      ],
      "pagination": {
        "current_page": 1,
        "total_pages": 10,
        "total_items": 200,
        "items_per_page": 20
      }
    }
  }
  ```

### 2. è·å–è½¦è¾†è¯¦æƒ…
- **æ¥å£**: `GET /api/vehicles/:id`
- **æè¿°**: è·å–æŒ‡å®šè½¦è¾†çš„è¯¦ç»†ä¿¡æ¯
- **è·¯å¾„å‚æ•°**:
  - `id`: è½¦è¾†IDï¼ˆæ•°å­—ï¼‰
- **è¯·æ±‚å¤´**: `Authorization: Bearer <token>` (å¯é€‰ï¼Œç”¨äºè·å–å®Œæ•´æ‰‹æœºå·)
- **å“åº”æ•°æ®**:
  ```json
  {
    "code": 200,
    "message": "æŸ¥è¯¢æˆåŠŸ",
    "data": {
      "vehicle": {
        "id": 1,
        "vehicle_type": 1,
        "vehicle_status": 1,
        "car_brand": "ä¸°ç”°",
        "car_model": "å¡ç½—æ‹‰",
        "year": 2016,
        "current_price": 80000,
        "original_price": 120000,
        "mileage": 50000,
        "fuel_type": "æ±½æ²¹",
        "transmission": "è‡ªåŠ¨",
        "color": "ç™½è‰²",
        "contact_name": "å¼ å…ˆç”Ÿ",
        "contact_phone": "13800138000",
        "description": "è½¦å†µè‰¯å¥½ï¼Œæ— äº‹æ•…",
        "created_at": "2024-01-01T00:00:00.000Z",
        "updated_at": "2024-01-01T00:00:00.000Z",
        "images": [
          {
            "id": 1,
            "image_url": "https://example.com/image1.jpg",
            "description": "å‰è„¸ç…§ç‰‡",
            "created_at": "2024-01-01T00:00:00.000Z"
          }
        ]
      }
    }
  }
  ```

### 3. è·å–è½¦è¾†ç»Ÿè®¡ä¿¡æ¯
- **æ¥å£**: `GET /api/vehicles/stats`
- **æè¿°**: è·å–è½¦è¾†ç»Ÿè®¡ä¿¡æ¯
- **è¯·æ±‚å‚æ•°**: æ— 
- **å“åº”æ•°æ®**:
  ```json
  {
    "code": 200,
    "message": "æŸ¥è¯¢æˆåŠŸ",
    "data": {
      "total_vehicles": 1000,
      "available_vehicles": 800,
      "sold_vehicles": 200,
      "type_distribution": {
        "ç§å®¶è½¦": 600,
        "å®¢è´§è½¦": 200,
        "è´§è½¦": 150,
        "ç”µå•è½¦": 30,
        "ç»å…¸è½¦": 20
      },
      "brand_distribution": {
        "ä¸°ç”°": 150,
        "æœ¬ç”°": 120,
        "æ—¥äº§": 100,
        "å…¶ä»–": 630
      },
      "price_range": {
        "min": 10000,
        "max": 500000,
        "average": 150000
      }
    }
  }
  ```

## ğŸ”’ éšç§ä¿æŠ¤ç‰¹æ€§

### æ‰‹æœºå·è„±æ•æœºåˆ¶
- **æœªç™»å½•ç”¨æˆ·**: æ‰‹æœºå·æ˜¾ç¤ºä¸º `13******00` æ ¼å¼
- **å·²ç™»å½•ç”¨æˆ·**: æ˜¾ç¤ºå®Œæ•´æ‰‹æœºå· `13800138000`
- **å¤„ç†é€»è¾‘**: åŸºäºJWTä»¤ç‰ŒéªŒè¯ç™»å½•çŠ¶æ€ï¼Œæ¯«ç§’çº§å¤„ç†

### æƒé™æ§åˆ¶
- **å…¬å¼€æ¥å£**: è½¦è¾†åˆ—è¡¨ã€è½¦è¾†è¯¦æƒ…ã€ç»Ÿè®¡ä¿¡æ¯ï¼ˆè„±æ•ç‰ˆæœ¬ï¼‰
- **è®¤è¯æ¥å£**: ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ç™»å‡ºã€ä¸ªäººä¿¡æ¯
- **è®¿é—®æ§åˆ¶**: é€šè¿‡ä¸­é—´ä»¶éªŒè¯JWTä»¤ç‰Œ

## ğŸš« åçˆ¬è™«é˜²æŠ¤

### é˜²æŠ¤ç­–ç•¥
- **é¢‘ç‡é™åˆ¶**: æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ¬¡æ•°é™åˆ¶
- **çˆ¬è™«æ£€æµ‹**: User-Agentåˆ†æå’Œè¯·æ±‚æ¨¡å¼è¯†åˆ«
- **éªŒè¯ç ç³»ç»Ÿ**: å›¾å½¢éªŒè¯ç é˜²æ­¢è‡ªåŠ¨åŒ–æ”»å‡»
- **åŠ¨æ€å“åº”**: éšæœºå»¶è¿Ÿå’Œå“åº”éšæœºåŒ–

### é…ç½®å‚æ•°
- `CRAWLER_DETECTION_ENABLED`: æ˜¯å¦å¯ç”¨çˆ¬è™«æ£€æµ‹
- `CRAWLER_MAX_REQUESTS_PER_MINUTE`: æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°
- `CRAWLER_STRICT_IP_LIMIT`: æ˜¯å¦å¯ç”¨ä¸¥æ ¼IPé™åˆ¶

## ğŸ“ é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 200 | æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒè®¿é—® |
| 403 | ç¦æ­¢è®¿é—® |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### 1. è·å–éªŒè¯ç 
```bash
curl -X GET http://localhost:3000/api/captcha
```

### 2. ç”¨æˆ·æ³¨å†Œ
```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456",
    "real_name": "æµ‹è¯•ç”¨æˆ·",
    "email": "test@example.com",
    "gender": "male",
    "phone": "13800138000",
    "captcha": "1234",
    "captchaId": "captcha_id"
  }'
```

### 3. ç”¨æˆ·ç™»å½•
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456"
  }'
```

### 4. è·å–è½¦è¾†åˆ—è¡¨ï¼ˆæœªç™»å½•ï¼‰
```bash
curl -X GET "http://localhost:3000/api/vehicles?page=1&limit=5"
```

### 5. è·å–è½¦è¾†åˆ—è¡¨ï¼ˆå·²ç™»å½•ï¼‰
```bash
curl -X GET "http://localhost:3000/api/vehicles?page=1&limit=5" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰APIä½¿ç”¨é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ã€‚
