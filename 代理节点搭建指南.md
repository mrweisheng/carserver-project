# 香港服务器代理节点搭建指南

## 服务器信息
- **服务器IP**: 103.117.122.232
- **域名**: coco.huaxing.help
- **系统**: Ubuntu
- **目标**: 搭建V2Ray代理节点

## 第一步：系统基础配置

### 1.1 更新系统 ✅
```bash
sudo apt update && sudo apt upgrade -y
```
**状态**: 已完成 - 系统更新成功

### 1.2 安装必要工具 ✅
```bash
sudo apt install -y curl wget unzip vim htop
```
**状态**: 已完成 - 必要工具安装成功

### 1.3 配置时区 ✅
```bash
sudo timedatectl set-timezone Asia/Hong_Kong
```
**状态**: 已完成 - 时区设置为香港时区

## 第二步：安装V2Ray

### 2.1 下载并安装V2Ray ✅
```bash
bash <(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)
```
**状态**: 已完成 - V2Ray v5.37.0 安装成功

### 2.2 启用V2Ray服务 ✅
```bash
sudo systemctl enable v2ray
sudo systemctl start v2ray
```
**状态**: 已完成 - V2Ray服务已启用并启动

## 第三步：配置V2Ray

### 3.1 生成UUID ✅
```bash
cat /proc/sys/kernel/random/uuid
```
**生成的UUID**: `3da67dac-3bd1-4129-8f6e-9588b4de7cf0`
**状态**: 已完成 - UUID已生成并记录

### 3.2 创建V2Ray配置文件 ✅
```bash
sudo vim /usr/local/etc/v2ray/config.json
```
**状态**: 已完成 - V2Ray配置文件已创建并保存

### 3.3 V2Ray配置内容
```json
{
  "inbounds": [{
    "port": 443,
    "protocol": "vmess",
    "settings": {
      "clients": [{
        "id": "3da67dac-3bd1-4129-8f6e-9588b4de7cf0",
        "level": 1,
        "alterId": 0
      }]
    },
    "streamSettings": {
      "network": "ws",
      "security": "tls",
      "tlsSettings": {
        "certificates": [{
          "certificateFile": "/etc/letsencrypt/live/coco.huaxing.help/fullchain.pem",
          "keyFile": "/etc/letsencrypt/live/coco.huaxing.help/privkey.pem"
        }]
      },
      "wsSettings": {
        "path": "/v2ray"
      }
    }
  }],
  "outbounds": [{
    "protocol": "freedom",
    "settings": {}
  }]
}
```

## 第四步：安装和配置SSL证书

### 4.1 安装Certbot ✅
```bash
sudo apt install -y certbot
```
**状态**: 已完成 - Certbot安装成功

### 4.2 申请SSL证书 ✅
```bash
sudo certbot certonly --standalone -d coco.huaxing.help
```
**状态**: 已完成 - SSL证书申请成功
**证书路径**: `/etc/letsencrypt/live/coco.huaxing.help/`
### 4.3 设置证书自动续期
```bash
sudo crontab -e
```
添加以下行：
```
0 3 * * * /usr/bin/certbot renew --quiet && systemctl restart v2ray
```

## 第五步：配置防火墙

### 5.1 安装UFW ✅
```bash
sudo apt install -y ufw
```
**状态**: 已完成 - UFW防火墙安装成功

### 5.2 配置防火墙规则 ✅
```bash
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 443/tcp
sudo ufw enable
```
**状态**: 已完成 - 防火墙配置成功，已开放SSH和443端口

## 第六步：启动服务

### 6.1 重启V2Ray服务 ✅
```bash
sudo systemctl restart v2ray
sudo systemctl status v2ray
```
**状态**: 已完成 - V2Ray服务运行正常 (active)

### 6.2 检查服务状态
```bash
sudo journalctl -u v2ray -f
```

## 第七步：客户端配置

### 7.1 客户端配置参数
- **地址**: coco.huaxing.help
- **端口**: 443
- **用户ID**: [第3.1步生成的UUID]
- **额外ID**: 0
- **加密方式**: auto
- **传输协议**: ws
- **路径**: /v2ray
- **TLS**: 开启

### 7.2 V2RayN客户端配置示例
```json
{
  "v": "2",
  "ps": "香港节点",
  "add": "coco.huaxing.help",
  "port": "443",
  "id": "YOUR_UUID_HERE",
  "aid": "0",
  "net": "ws",
  "type": "none",
  "host": "coco.huaxing.help",
  "path": "/v2ray",
  "tls": "tls"
}
```

## 第八步：性能优化

### 8.1 调整系统参数
```bash
sudo vim /etc/sysctl.conf
```
添加以下内容：
```
net.core.default_qdisc=fq
net.ipv4.tcp_congestion_control=bbr
net.ipv4.tcp_rmem = 8192 262144 536870912
net.ipv4.tcp_wmem = 4096 65536 536870912
net.core.rmem_max = 536870912
net.core.wmem_max = 536870912
```

### 8.2 应用系统参数
```bash
sudo sysctl -p
```

## 第九步：监控和维护

### 9.1 查看连接状态
```bash
sudo ss -tulpn | grep :443
```

### 9.2 查看V2Ray日志
```bash
sudo journalctl -u v2ray --since "1 hour ago"
```

### 9.3 重启服务
```bash
sudo systemctl restart v2ray
```

## 故障排除

### 常见问题
1. **证书问题**: 检查域名解析是否正确
2. **端口被占用**: 使用 `sudo netstat -tulpn | grep :443` 检查
3. **防火墙阻挡**: 检查UFW规则和云服务商安全组
4. **时间同步**: 确保服务器时间准确

### 测试连接
```bash
# 测试端口是否开放
telnet coco.huaxing.help 443

# 测试SSL证书
openssl s_client -connect coco.huaxing.help:443
```

## 安全建议

1. **定期更新系统**
2. **更改SSH默认端口**
3. **禁用root登录**
4. **使用密钥认证**
5. **定期备份配置文件**
6. **监控异常流量**

---

**注意事项**:
- 请将配置中的 `YOUR_UUID_HERE` 替换为实际生成的UUID
- 确保域名已正确解析到服务器IP
- 定期检查证书有效期
- 遵守当地法律法规

**创建时间**: $(date)
**服务器**: 103.117.122.232 (coco.huaxing.help)
**配置类型**: V2Ray WebSocket + TLS